<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Unreal Webcam Fun</title>
</head>

<body>
    <style>
        video{
            width: 50px;
            height: 50px;
        }
        #ouputInmage{
            text-align: left;
        }
        </style>
        <video id="videoWebcam" autoplay>Not supported in your brower</video>
        <audio src="audio/mi.wav" id="snapAudio"></audio>
    <center>
        <h1>Unreal Webcam Fun</h1>
        <canvas id="videoCanvas">

        </canvas>
        <div id="ouputInmage">

        </div>
    </center>
    <script>
        const video = document.getElementById('videoWebcam');
        const audio = document.getElementById('snapAudio');
        const canvas = document.getElementById('videoCanvas');
        const ouputInmage = document.getElementById('ouputInmage');
        const ctx=canvas.getContext('2d');
        const constraints = {
            audio: false,
            video: {
                width: {
                    ideal: 1000
                },
                height: {
                    ideal: 500
                }
            }
        }
        function getVideo(){
            navigator.mediaDevices.getUserMedia(constraints)
            .then( (mediaStream) =>{
                video.srcObject = mediaStream;
                video.onloadedmetadata = function (e) {
                    video.play();
                };
            })
            .catch( (err) =>  console.log(err.name + ": " + err.message) );
        }
        function drawCanvas(){
            const width=video.videoWidth;
            const height=video.videoHeight;
            canvas.width=width;
            canvas.height=height;

           const playcanvas=  setInterval( function(){
                ctx.drawImage(video, 0 ,0 ,width, height);
            },18)          
        }

        function takePhoto(event){
           if(event.shiftKey){
            audio.currentTime=0;
            audio.play();
            //clearInterval(playcanvas) ;
            let photo = canvas.toDataURL('image/jpeg', 1.0);
            let link= document.createElement('a');
            let img=document.createElement('img');
           
            link.href=photo;
            link.setAttribute('download','w3logo')
            link.setAttribute('style','padding: 5px')
            img.src=photo;
            img.setAttribute('style','width: 100px;height: 50px;');

            link.appendChild(img);

            ouputInmage.appendChild(link);
           }              
        }
        getVideo();


        video.addEventListener('canplay',drawCanvas);
        window.addEventListener('mousedown',takePhoto);
        
    </script>


</body>

</html>